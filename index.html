<!DOCTYPE html>
<html>
<head>
<title>DougPost</title>
<meta charset="UTF-8">
<script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous">
</script>


<link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.2/jsgrid.min.css" />
<link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.2/jsgrid-theme.min.css" />
 
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.2/jsgrid.min.js"></script>

<script>

  var selectedPage;

  window.fbAsyncInit = function() {
    FB.init({
      appId      : '536759713186208',
      xfbml      : false,  // if true will parse page looking for other xbfml plugins
      version    : 'v2.8',
      status     : true,
      cookie     : true
    });
    FB.Event.subscribe('auth.authResponseChange', initDougPost);
    console.log('FInishing fbAsyncInit.');
    FB.getLoginStatus(initDougPost);  // this isn't being called by the authResponseChange event initially... (?)
  };


  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));

function initDougPost(r) {
  console.log('r.status is '+r.status);
  if (r.status === 'connected') {
    if (selectedPage) { listPosts(); }
    else { listPages(); }
    }
  else if (r.status === 'not_authorized') {
    $('#x').html("<button onclick='FB.login(initDougPost, {scope:&quot;pages_show_list&quot;})'>The app needs your permission to list your pages</button>");

    }
  else {
    $('#x').html("<button onclick='FB.login(initDougPost, {scope:&quot;pages_show_list&quot;})'>Log in to Facebook to enable the app</button>");
    }


  console.log('In initDougPost with '+JSON.stringify(r));
  $('#dpstatus').html(JSON.stringify(r));
  }
function listPages() {
  console.log('listing pages');
  FB.api('/me/accounts', function(response) {
    var pages = response['data'];
    $('#x').html("<div id='jsGrid'></div>");
    $("#jsGrid").jsGrid({
        width: "60%",
        height: "400px",
 
        inserting: false,
        editing: true,
        sorting: true,
        paging: true,
 
        data: response['data'],
        rowClick: function (a) { selectedPage=a.item; FB.getLoginStatus(initDougPost);},
 
        fields: [
            { name: "name", type: "text", width: "40%" },
            { name: "category", type: "text", width: "60%" },
        ]
      });

     console.log('the response is '+JSON.stringify(response));
     });
  }

function listPosts() {
  console.log('listing posts');
  FB.api('/'+selectedPage['id']+'/posts', function(response) {
    ///var posts = response['data'].map( function (x) { return { typ  } );


    console.log(JSON.stringify(response));
    $('#x').html("<a href='javascript:selectedPage=null;FB.getLoginStatus(initDougPost);'>Back to list of pages</a><p><div id='jsGrid'></div>");
    $("#jsGrid").jsGrid({
        width: "60%",
        height: "400px",
 
        inserting: false,
        editing: true,
        sorting: true,
        paging: true,
 
        data: response['data'], 
        rowClick: function (a) { selectedPage=a.item; FB.getLoginStatus(initDougPost);},
 
        fields: [
            { name: 'type', type: 'text', width: '10%' },
            { name: "id", type: "text", width: "30%" },
            { name: "created_time", type: "text", width: "40%" },
            { name: 'message', type: 'text', width: '20%' }
        ]
      });
    });
  
  }

</script>


</head>

<body>
<h2>DougPost</h2>
<div id=x></div>



</body>

</html>
